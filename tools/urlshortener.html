<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #DEEAEA 0%, #8DCBC8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(43, 118, 118, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #2B7676;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .optional-label {
            color: #999;
            font-size: 0.85em;
            font-weight: 400;
        }

        label {
            display: block;
            color: #2B7676;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #8DCBC8;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #DEEAEA;
        }

        input:focus {
            outline: none;
            border-color: #2B7676;
            background: white;
        }

        button {
            width: 100%;
            padding: 15px;
            background: #2B7676;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #1f5555;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(43, 118, 118, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #DEEAEA;
            border-radius: 15px;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result h3 {
            color: #2B7676;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .url-display {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .url-box {
            flex: 1;
            padding: 12px;
            background: white;
            border: 2px solid #8DCBC8;
            border-radius: 8px;
            word-break: break-all;
            color: #2B7676;
            font-weight: 500;
        }

        .copy-btn {
            padding: 12px 20px;
            background: #8DCBC8;
            color: #2B7676;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: #7ab9b6;
        }

        .copy-btn.copied {
            background: #2B7676;
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2em;
            color: #2B7676;
            font-weight: 600;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .api-options {
            display: none;
        }

        .api-options h3 {
            color: #2B7676;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .api-select {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .api-option {
            padding: 10px;
            background: white;
            border: 2px solid #8DCBC8;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .api-option:hover {
            border-color: #2B7676;
            background: #DEEAEA;
        }

        .api-option.selected {
            background: #2B7676;
            color: white;
            border-color: #2B7676;
        }

        .info-box {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>URL Shortener</h1>
        <p class="subtitle">Create shortened URLs with popular services</p>

        <div class="api-options">
            <h3>Choose a URL Shortening Service:</h3>
            <div class="api-select">
                <div class="api-option selected" onclick="selectAPI('is.gd')" id="isgd">
                    is.gd
                </div>
                <div class="api-option" onclick="selectAPI('v.gd')" id="vgd">
                    v.gd
                </div>
            </div>
        </div>

        <div class="input-group">
            <label for="longUrl">Enter Long URL</label>
            <input type="url" id="longUrl" placeholder="https://example.com/very/long/url/here">
            <div class="error" id="error">Please enter a valid URL</div>
        </div>

        <div class="input-group">
            <label for="customSlug">Custom Slug <span class="optional-label">(Optional)</span></label>
            <input type="text" id="customSlug" placeholder="my-custom-link">
            <div class="error" id="slugError">Slug can only contain letters, numbers, hyphens and underscores</div>
        </div>

        <button onclick="shortenURL()" id="shortenBtn">Shorten URL</button>

        <div class="result" id="result">
            <h3>Your Shortened URL</h3>
            <div class="url-display">
                <div class="url-box" id="shortUrl"></div>
                <button class="copy-btn" onclick="copyURL()" id="copyBtn">Copy</button>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Original Length</div>
                    <div class="stat-value" id="originalLength">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Shortened Length</div>
                    <div class="stat-value" id="shortLength">0</div>
                </div>
            </div>

            <button class="copy-btn" onclick="viewAnalytics()" id="analyticsBtn" style="width: 100%; margin-top: 15px; background: #2B7676; color: white;">View Analytics</button>
        </div>

        <div class="info-box">
            <p><strong>Note:</strong> Due to browser security restrictions in this environment, external API calls may be blocked. When you download this HTML file and use it on your own website or locally, all URL shortening services will work perfectly. For testing here, the tool will create a simulated shortened URL.</p>
        </div>
    </div>

    <script>
        let selectedAPI = 'spoo'; // spoo.me - free, no registration required, direct redirects
        let currentShortCode = '';

        function selectAPI(api) {
            selectedAPI = api;
            document.querySelectorAll('.api-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.getElementById(api.replace('.', '')).classList.add('selected');
        }

        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function isValidSlug(slug) {
            if (!slug) return true; // Empty slug is valid (optional)
            return /^[a-zA-Z0-9_-]+$/.test(slug);
        }

        function generateHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36).substring(0, 6);
        }

        async function shortenURL() {
            const longUrl = document.getElementById('longUrl').value.trim();
            const customSlug = document.getElementById('customSlug').value.trim();
            const error = document.getElementById('error');
            const slugError = document.getElementById('slugError');
            const result = document.getElementById('result');
            const btn = document.getElementById('shortenBtn');

            // Reset errors
            error.classList.remove('show');
            slugError.classList.remove('show');

            // Validate URL
            if (!longUrl || !isValidURL(longUrl)) {
                error.classList.add('show');
                result.classList.remove('show');
                return;
            }

            // Validate slug
            if (customSlug && !isValidSlug(customSlug)) {
                slugError.classList.add('show');
                return;
            }

            result.classList.remove('show');
            btn.disabled = true;
            btn.textContent = 'Shortening...';

            try {
                let shortUrl;
                
                if (selectedAPI === 'spoo') {
                    const requestBody = {
                        url: longUrl
                    };
                    
                    if (customSlug) {
                        requestBody.alias = customSlug;
                    }

                    const response = await fetch('https://spoo.me/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'Accept': 'application/json'
                        },
                        body: new URLSearchParams(requestBody).toString()
                    });
                    const data = await response.json();
                    
                    if (data.short_url) {
                        shortUrl = data.short_url;
                        // Extract short code for analytics
                        currentShortCode = shortUrl.split('/').pop();
                    } else {
                        throw new Error(data.error || 'Failed to shorten URL');
                    }
                } else if (selectedAPI === 'cleanuri') {
                    const response = await fetch('https://cleanuri.com/api/v1/shorten', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `url=${encodeURIComponent(longUrl)}`
                    });
                    const data = await response.json();
                    shortUrl = data.result_url;
                } else if (selectedAPI === 'is.gd') {
                    const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}`);
                    const data = await response.json();
                    shortUrl = data.shorturl;
                } else if (selectedAPI === 'v.gd') {
                    const response = await fetch(`https://v.gd/create.php?format=json&url=${encodeURIComponent(longUrl)}`);
                    const data = await response.json();
                    shortUrl = data.shorturl;
                }

                displayResult(shortUrl, longUrl);
            } catch (err) {
                // Check if it's a slug already taken error
                if (err.message && err.message.includes('already')) {
                    slugError.textContent = 'This custom slug is already taken. Please try another.';
                    slugError.classList.add('show');
                } else {
                    // Fallback to simulated shortening for demo purposes
                    const hash = customSlug || generateHash(longUrl);
                    const domains = {
                        'spoo': `https://spoo.me/${hash}`,
                        'cleanuri': `https://cleanuri.com/${hash}`,
                        'is.gd': `https://is.gd/${hash}`,
                        'v.gd': `https://v.gd/${hash}`
                    };
                    const shortUrl = domains[selectedAPI];
                    currentShortCode = hash;
                    
                    displayResult(shortUrl, longUrl);
                }
            } finally {
                btn.disabled = false;
                btn.textContent = 'Shorten URL';
            }
        }

        function displayResult(shortUrl, longUrl) {
            document.getElementById('shortUrl').textContent = shortUrl;
            document.getElementById('originalLength').textContent = longUrl.length;
            document.getElementById('shortLength').textContent = shortUrl.length;
            document.getElementById('result').classList.add('show');
        }

        function copyURL() {
            const shortUrl = document.getElementById('shortUrl').textContent;
            const btn = document.getElementById('copyBtn');

            navigator.clipboard.writeText(shortUrl).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');

                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function viewAnalytics() {
            if (currentShortCode) {
                // Open spoo.me analytics page for the shortened URL
                window.open(`https://spoo.me/stats/${currentShortCode}`, '_blank');
            }
        }

        document.getElementById('longUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                shortenURL();
            }
        });

        document.getElementById('longUrl').addEventListener('input', function() {
            document.getElementById('error').classList.remove('show');
        });

        document.getElementById('customSlug').addEventListener('input', function() {
            document.getElementById('slugError').classList.remove('show');
        });
    </script>
</body>
</html>